<!-- 主要内容 -->
<div class="container">
    <ul class="breadcrumb">
        <li><a href="/">首页</a></li>
        <li class="active">搜索</li>
    </ul>
    <!-- 简介 -->
    <div class="row">
        <div class="col-lg-9">
            <div class="page-title J_postId" data-id="270">
                <h3>{$article["title"]} <span>[{$article.c_name}]</span></h3>
                <span>作者：<a href="/member/index/1.html">{$article.username}</a></span>
                <span>发布于：{$article["create_time"]|date="Y/m/d H:i:s",###}</span>
                <span>浏览：{$article['views']}次</span>
                <span><a href="javascript:;" class="j-collect">收藏</a></span>
            </div>

            <div class="page-content">
                <p></p>{$article.content}
                <div class="post-donate">
                    <span>如果文章对您有所帮助，希望继续支持我们，您的支持是我们最大的动力</span>
                    <a href="/donate/index.html" class="btn btn-success">￥打赏</a>
                </div>
                <div class="page-tag">
                    <b>标签：</b>
                    {volist name="tags" id="vo"}
                    <span><a
                            href="{:url('frontend/index/searchByTagId',['id'=>$vo['tag_id']])}">{$vo['name']}</a></span>
                    {/volist}
                    <div class="page-declare">
                        <b>声明：</b><span>文章内容由作者原创或整理，未经允许，不得转载！</span>
                    </div>
                    <div class="bdsharebuttonbox bdshare-button-style0-16" data-bd-bind="1501417808870">
                        <a href="#" class="bds_more" data-cmd="more"></a>
                        <a href="#" class="bds_qzone" data-cmd="qzone" title="分享到QQ空间"></a>
                        <a href="#" class="bds_tsina" data-cmd="tsina" title="分享到新浪微博"></a>
                        <a href="#" class="bds_tqq" data-cmd="tqq" title="分享到腾讯微博"></a>
                        <a href="#" class="bds_weixin" data-cmd="weixin" title="分享到微信"></a>
                    </div>
                    <script>window._bd_share_config = {
                        "common": {
                            "bdSnsKey": {},
                            "bdText": "",
                            "bdMini": "2",
                            "bdPic": "",
                            "bdStyle": "0",
                            "bdSize": "16"
                        },
                        "share": {},
                        "image": {
                            "viewList": ["qzone", "tsina", "tqq", "renren", "weixin"],
                            "viewText": "分享到：",
                            "viewSize": "16"
                        }
                    };
                    with (document)0[(getElementsByTagName('head')[0] || body).appendChild(createElement('script')).src = 'http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion=' + ~(-new Date() / 36e5)];</script>
                </div>

                <div class="page-comment">
                    <div id="comments" style="margin-top: 10px;">
                        <div class="page-header">
                            <h2>共 {$commentCounts} 条评论</h2>
                        </div>
                        <ul id="reply" class="media-list J_mediaList">
                            {volist name="comments" id="vo"}
                            <li>
                                <div class="media-left">
                                    <a href="/member/index/{$vo.user_id}" rel="author" data-original-title="" title=""><img
                                            class="media-object" src="{$vo.avatar}"
                                            alt="{$vo.account}" data-bd-imgshare-binded="1"></a>
                                </div>
                                <div class="media-body">
                                    <div class="media-heading">
                                        <a href="/member/index/{$vo.user_id}" rel="author" data-original-title="" title="">{$vo.account}</a>
                                        评论于 {$vo.create_time|date="Y-m-d H:i:s",###}
                                    </div>

                                    <div class="media-content">
                                        <p>{$vo['comment_content']}</p>
                                        <div class="hint">共 <em>{$vo.children|count}</em> 条回复</div>
                                        <!----------------二级--------------->
                                        {volist name="vo.children" id="sub"}
                                        <div class="media">
                                            <div class="media-left">
                                                <a href="/user/32840" rel="author">
                                                    <img class="media-object" src="{$sub.avatar}" alt="{$sub.account}">
                                                </a>
                                            </div>
                                            <div class="media-body">
                                                <div class="media-heading">
                                                    <a href="/user/32840" rel="author">
                                                        {$sub.account}
                                                    </a>
                                                    回答于 {$sub.create_time|date="Y-m-d H:i:s",###} <span class="pull-right">
                                                    <a class="comment-reply" href="javascript:void(0);">
                                                        <i class="fa fa-reply"></i>
                                                        回复
                                                    </a>
                                                     <span class="dot">•</span>
                                                     <a href="/answer/update?id=13124">
                                                         <i class="fa fa-pencil"></i>
                                                         修改
                                                     </a>                                                                    </span>
                                                </div>
                                                <div class="media-content"><p> {$sub['comment_content']}</p>
                                                </div>
                                            </div>
                                        </div>
                                        {/volist}
                                    </div>

                                    <div class="media-action">
                                        <a class="comment-reply" href="javascript:void(0);"><i class="fa fa-reply"></i> 回复</a>
                                        <span class="pull-right">
                                            <a class="vote up" href="javascript:void(0);" title="" data-type="answer"
                                               data-id="13110"
                                               data-toggle="tooltip" data-original-title="顶">
                                                <i class="fa fa-thumbs-o-up"></i> 0</a>
                                            <a class="vote down" href="javascript:void(0);" title="" data-type="answer"
                                               data-id="13110"
                                               data-toggle="tooltip"
                                               data-original-title="踩">
                                                <i class="fa fa-thumbs-o-down"></i> 0
                                            </a>
                                        </span>
                                    </div>
                                    <form id="w3" class="reply-form" action="{:url('/frontend/index/commentReply')}"
                                          method="post">
                                        <input type="hidden" id="user_id" class="form-control" name="user_id"
                                               value="{$userInfo.id}">
                                        <input type="hidden" id="post_id" class="form-control" name="post_id"
                                               value="{$vo.post_id}">
                                        <div class="form-group field-answer-parent_id">
                                            <input type="hidden" id="answer-parent_id" class="parent_id"
                                                   name="parent_id" value="{$vo.comment_id}">
                                        </div>
                                        <div class="form-group field-answer-reply-content required">
                                            <textarea id="answer-reply-content" class="form-control"
                                                      name="comment_content" aria-required="true"></textarea>
                                            <div class="help-block"></div>
                                        </div>
                                        <div class="form-group">
                                            <button type="submit" class="btn btn-sm btn-primary">回复</button>
                                        </div>
                                    </form>
                                </div>
                            </li>
                            {/volist}
                        </ul>
                    </div>
                    <input type="hidden" value="/comment/reply.html" class="j_reply_url">
                </div>

                <div class="page-comment">
                    <div class="panel">

                        {if condition="$Think.session.open_user_username"}
                        <div class="panel-content">
                            <form id="w1" action="{:url('/frontend/index/commentStore')}" method="post" role="form">
                                <input type="hidden" id="commentform-post_id" class="form-control" name="post_id"
                                       value="{$article.id}">
                                <input type="hidden" id="commentform-user_id" class="form-control" name="user_id"
                                       value="{$userInfo.id}">
                                <textarea name="comment_content" id="comment_content"
                                          style="width:600px;height:200px;"></textarea>
                                <div class="form-actions center">
                                    <P></P>
                                    <button type="submit" class="btn btn-sm btn-primary">提交</button>
                                </div>
                            </form>
                        </div>
                        {else /}
                        <div class="well danger">您需要登录后才可以评论哦! <a href="{:url('frontend/member/signin')}">登录</a> | <a
                                href="{:url('frontend/member/signup')}">立即注册</a></div>
                        {/if}
                    </div>
                </div>
            </div>
        </div>

        <div class="col-lg-3">
            <div class="panel">
                <div class="panel-title box-title">
                    <span>最新文章</span>
                    <span class="pull-right"><a href="/post/index.html" class="font-12">更多»</a></span>
                </div>
                <div class="new last-post J_lastTime">
                </div>
            </div>
        </div>
    </div>

</div>

<script type="text/javascript">
    SyntaxHighlighter.all();
</script>
<script type="text/javascript" charset="utf-8">
    window.UEDITOR_HOME_URL = "__COMMON__/plugins/ueditor/";
    var ue = UE.getEditor('comment_content', {
        initialFrameWidth: 800,   //初始化宽度
        initialFrameHeight: 200,   //初始化高度
        serverUrl: "{:url('/frontend/index/saveinfo')}"
    });
</script>
<script>
    $(function(){
        //点击提交评论内容
        $('body').delegate('.comment-submit','click',function(){
            var content = $.trim($(this).parent().prev().children("textarea").val());//根据布局结构获取当前评论内容
            $(this).parent().prev().children("textarea").val("");//获取完内容后清空输入框
            if(""==content){
                alert("评论内容不能为空!");
            }else{
                var cmdata = new Object();
                cmdata.parent_id = $(this).attr("parent_id");//上级评论id
                cmdata.content = content;
                cmdata.nickname = "游客";//测试用数据
                cmdata.head_pic = "/Public/images/default.jpg";//测试用数据
                var replyswitch = $(this).attr("replyswitch");//获取回复开关锁属性

                $.ajax({
                    type:"POST",
                    url:"/index.php/home/index/addComment",
                    data:{
                        comment:JSON.stringify(cmdata)
                    },
                    dataType:"json",
                    success:function(data){
                        if(typeof(data.error)=="undefined"){
                            $(".comment-reply").next().remove();//删除已存在的所有回复div
                            //更新评论总数
                            $(".comment-num").children("span").html(data.num+"条评论");
                            //显示新增评论
                            var newli = "";
                            if(cmdata.parent_id == "0"){
                                //发表的是一级评论时，添加到一级ul列表中
                                newli = "<li comment_id='"+data.id+"'><div ><div><img class='head-pic'  src='"+data.head_pic+"' alt=''></div><div class='cm'><div  class='cm-header'><span>"+data.nickname+"</span><span>"+data.create_time+"</span></div><div class='cm-content'><p>"+data.content+"</p></div><div class='cm-footer'><a class='comment-reply' comment_id='"+data.id+"'  href='javascript:void(0);'>回复</a></div></div></div><ul class='children'></ul></li>";
                                $(".comment-ul").prepend(newli);
                            }else{
                                //否则添加到对应的孩子ul列表中
                                if('off'==replyswitch){//检验出回复关闭锁存在，即三级评论不再提供回复功能
                                    newli = "<li comment_id='"+data.id+"'><div ><div><img class='head-pic'  src='"+data.head_pic+"' alt=''></div><div class='children-cm'><div  class='cm-header'><span>"+data.nickname+"</span><span>"+data.create_time+"</span></div><div class='cm-content'><p>"+data.content+"</p></div><div class='cm-footer'></div></div></div><ul class='children'></ul></li>";
                                }else{//二级评论的回复按钮要添加回复关闭锁属性
                                    newli = "<li comment_id='"+data.id+"'><div ><div><img class='head-pic'  src='"+data.head_pic+"' alt=''></div><div class='children-cm'><div  class='cm-header'><span>"+data.nickname+"</span><span>"+data.create_time+"</span></div><div class='cm-content'><p>"+data.content+"</p></div><div class='cm-footer'><a class='comment-reply' comment_id='"+data.id+"'  href='javascript:void(0);' replyswitch='off' >回复</a></div></div></div><ul class='children'></ul></li>";
                                }
                                $("li[comment_id='"+data.parent_id+"']").children("ul").prepend(newli);
                            }

                        }else{
                            //有错误信息
                            alert(data.error);
                        }

                    }
                });
            }


        });

        //点击"回复"按钮显示或隐藏回复输入框
        $("body").delegate(".comment-reply","click",function(){
            if($(this).next().length>0){//判断出回复div已经存在,去除掉
                $(this).next().remove();
            }else{//添加回复div
                $(".comment-reply").next().remove();//删除已存在的所有回复div
                //添加当前回复div
                var parent_id = $(this).attr("comment_id");//要回复的评论id

                var divhtml = "";
                if('off'==$(this).attr("replyswitch")){//二级评论回复后三级评论不再提供回复功能,将关闭属性附加到"提交回复"按钮"
                    divhtml = "<div class='div-reply-txt' style='width:98%;padding:3px;' replyid='2'><div><textarea id='answer-reply-content' name='comment_content' class='txt-reply form-control' replyid='2' style='width: 100%; height: 60px;'></textarea></div><div style='margin-top:5px;text-align:right;'><a class='comment-submit'  parent_id='"+parent_id+"'  href='javascript:void(0);' replyswitch='off' >提交回复</a></div></div>";
                }else{
                    divhtml = "<div class='div-reply-txt' style='width:98%;padding:3px;' replyid='2'><div><textarea class='txt-reply' replyid='2' style='width: 100%; height: 60px;'></textarea></div><div style='margin-top:5px;text-align:right;'><a class='comment-submit'  parent_id='"+parent_id+"'  href='javascript:void(0);'>提交回复</a></div></div>";
                }
                $(this).after(divhtml);
            }
        });

    })
</script>